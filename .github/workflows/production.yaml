name: Vercel Production Deployment

env:
    VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
    VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

on:
    push:
        branches:
            - main

defaults:
  run:
    working-directory: frontend

jobs:
  checks:
    name: Code Quality Checks
    runs-on: ubuntu-latest
    strategy:
      matrix:
        bun-version: ["1.1.34"]

    steps:
        - uses: actions/checkout@v4
            
        - name: Set up Bun ${{ matrix.bun-version }}
          uses: oven-sh/setup-bun@v2
          with:
            bun-version: ${{ matrix.bun-version }}

        - name: Install dependencies
          run: bun install --frozen-lockfile

        - name: Install Vercel CLI
          run: bun install --global vercel

        - name: Pull Vercel Environment Information
          run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}

        - name: Build Project Artifacts
          run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}

        - name: Deploy Project Artifacts
          run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}
